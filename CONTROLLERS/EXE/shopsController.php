<?php$rows = SQL_ROWS(q("SELECT props.id_item FROM propsLEFT JOIN city ON city.id = props.val WHERE props.table = 'shops' ANDprops.col = 'city' ANDcity.name = '".db_secur(SITE::$my_place[0])."'"));$rows = array_column($rows, 'id_item');$shops_ids = SQL_ROWS_FIELD(q("SELECT shops.id FROM shopsLEFT JOIN cityON city.id = shops.cityWHERE city.name = '".db_secur(SITE::$my_place[0])."'"), 'id');$rows = array_merge($rows, array_column($shops_ids, 'id'));if(count($rows) > 0) {    $dt = Core::$DT;    $shops = SQL_ROWS_FIELD(q("        SELECT shops.id, shops.logo, shops.name, shops.title, shops.domain, shops.descr FROM `shops`        WHERE         `id` IN (" . implode(',', $rows) . ") AND         `title` <> 'Бесплатный' AND         `active_to` > '" . $dt . "' AND         `active`=1"), 'id'    );    shuffle($shops);} else {    $shops = [];}//wtf($shops, 1);//wtf(SITE::$my_place, 1);//wtf($rows, 1);