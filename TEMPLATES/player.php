<?php?><div id="jquery_jplayer_1" class="jp-jplayer"></div><div id="jp_container_1" class="jp-audio" role="application" aria-label="media player">    <div onclick="update_tree_player()" class="player-header">        <div class="svg-wrapper"><?=RBS::SVG('rumbra.svg')?></div>        <span>PLAYER</span>    </div>    <button style="top: -35px" class="close-map-btn svg-wrapper"><?=RBS::SVG('note.svg')?></button>    <div id="folder-wrapper">        <div id="finder-wrapper" class="flex gap-5 align-center"><input onchange="sel_all_audio(this)" id="check-all" class="disabled" type="checkbox"><input style="padding: 2px 4px; font-size: 15px; outline: 1px dotted rgba(0,128,0,0.3); background-color: #000000" type="text"><button onclick="add_check_list_in()" class="btn invisible">Добавить</button><ul id="find-media"></ul></div>        <?php        if(Access::scanLevel() > 0) { ?>            <div id="folders"></div>        <? } ?>    </div>    <div class="jp-type-playlist">        <div class="jp-gui jp-interface">            <div class="jp-volume-controls">                <button class="jp-mute" role="button" tabindex="0">mute</button>                <button class="jp-volume-max" role="button" tabindex="0">max volume</button>                <div class="jp-volume-bar">                    <div class="jp-volume-bar-value"></div>                </div>            </div>            <div class="jp-controls-holder">                <div class="jp-controls">                    <button class="jp-previous" role="button" tabindex="0">previous</button>                    <button class="jp-play" role="button" tabindex="0">play</button>                    <button class="jp-stop" role="button" tabindex="0">stop</button>                    <button class="jp-next" role="button" tabindex="0">next</button>                </div>                <div class="jp-progress">                    <div class="jp-seek-bar">                        <div class="jp-play-bar"></div>                    </div>                </div>                <div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>                <div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>                <div class="jp-toggles">                    <button class="jp-repeat" role="button" tabindex="0">repeat</button>                    <button class="jp-shuffle" role="button" tabindex="0">shuffle</button>                </div>            </div>        </div>        <div class="jp-playlist">            <ul>                <li>&nbsp;</li>            </ul>        </div>        <div class="jp-no-solution">            <span>Update Required</span>            To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.        </div>    </div>    <?php if(Access::scanLevel() > 0) { ?>    <div id="indicators" class="flex gap-5 column"></div>    <div class="player-footer flex center align-bottom">        <div class="add-modul flex column">            <button onclick="load_mp3()" class="flex gap-10 action-btn align-center">                <div style="width: 25px; height: 25px" class="svg-wrapper"><?=RBS::SVG('add_files.svg')?></div>                <span>Выберете (.mp3)</span>            </button>            <div style="font-size: 11px; color: #ffffff;">или перетащите файлы сюда</div>        </div>    </div>    <input style="display: none" id="input-files" type="file" accept=".mp3" multiple="multiple">    <?php } ?></div><script>    let tracks = <?=json_encode($tracks, JSON_UNESCAPED_UNICODE)?>;    $(document).ready(function(){        jplayer = new jPlayerPlaylist({            jPlayer: "#jquery_jplayer_1",            cssSelectorAncestor: "#jp_container_1"        }, [            <?php foreach($musics as $v) { ?>            {                title:"<?=$v['user_name']?>",                mp3:"<?=Core::$DOMAIN?>DOWNLOAD/<?=$v['sys_name']?>",                "data-id": <?=$v['id']?>,            },            <?php } ?>        ], {            swfPath: "/RESURSES/jplayer",            supplied: "mp3",            wmode: "window",            useStateClassSkin: true,            autoBlur: false,            smoothPlayBar: true,            keyEnabled: false,            autoPlay: true,            playlistOptions: {                enableRemoveControls: true,                enableDragAndDrop: true,            },            enableDrag: true,        });        // Добавляем обработчик события contextmenu на элементы плейлиста        // $("#jp_container_1").on("contextmenu", ".jp-playlist ul li", function(e) {        //     let obj = this;        //     e.preventDefault();        //     let index = $(this).index();        //     let playlistItem = jplayer.playlist[index];        //     console.log("Выбранный элемент плейлиста:");        //     console.dir(playlistItem);        //     let lst = {        //         'Удалить композицию': function() {        //             SENDER('del_audio', {id: playlistItem['data-id']}, function(mess) {        //                 mess_executer(mess, function(mess) {        //                     $(obj).find('.jp-playlist-item-remove').click();        //                 });        //             });        //         },        //         'Сделать общедоступной': function() {        //        //         },        //     };        //     info_variants(undefined, lst);        // });        render_open_folder(tracks);        // setTimeout(function() {        //     $('#folders > details > summary').click();        // }, 200);    });    function addTrackToPlaylist(title, mp3, new_id) {        let playlist = jplayer;        let newTrack = {            title: title,            mp3: mp3,            "data-id": new_id,        };        playlist.add(newTrack);    }    // setTimeout(function() {    //     addTrackToPlaylist('НОВАЯ', '/DOWNLOAD/20231102-193113_id-2-807616.mp3');    // }, 3000);    <?php if(Access::scanLevel() > 0) { ?>    function load_mp3() {        $('#input-files').click();    }    document.querySelector('#input-files').onchange = function (event) {        const files = event.target.files;        for(let file of files) {            if (file.size <= 11 * 1024 * 1024) {                upload__File(file);            } else {                say("Разрешено загружать файлы до 11 Мб", 2);            }        }    };    function upload__File(file) {        console.log('Файл ------------');        if(file.type !== 'audio/mpeg') {            say('Плеер поддерживает только аудио формат<br>(mp3, wav)', 2);            return false;        }        console.dir(file);        let ind = $('<div class="ind"><span>'+file.name+'</span><div class="ind-ind"></div></div>')        $('#indicators').append(ind);        let target_folder = 'Моя музыка/Загрузки';        if($('.yellow-border').length > 0) {            target_folder = $('.yellow-border').attr('data-path');        }        const formData = new FormData();        formData.append("userfile", file);        formData.append("com", 'files');        formData.append("table", 'file');        formData.append("column", 'none');        formData.append("in_player_folder", target_folder);        formData.append("id", -1);        const xhr = new XMLHttpRequest();        xhr.upload.onprogress = function(event) {            let percent = 100 - Math.round(event.total - event.loaded) / event.total * 100;            percent = Math.round(percent);            $(ind).find('.ind-ind').css('width', percent+'%');            // console.log('Загрузка данных: '+percent+' %');        };        xhr.onload = xhr.onerror = function() {            if (this.status === 200) {                let mess = JSON.parse(xhr.response);                console.dir(mess);                if(mess.status === 'ok') {                    addTrackToPlaylist(mess.user_name, '/DOWNLOAD/'+mess.sys_name, mess.insert_last_id);                    update_tree_player();                    $(ind).remove();                }            } else {                say('Не удалось отправить файл');            }            // console.log('ОТВЕТ='+ajax.responseText);            console.log('===============================');            console.log('===============================');        };        xhr.open("POST", domain, true);        xhr.responseType = 'text';        xhr.send(formData);    }    <?php } ?></script>