$(document).on('click', 'details', function(e) {    let obj = this;    setTimeout(function() {        let html = '';        if($mobile) {            html = $('#mobile-side-menu').html();            localStorage.removeItem('create-form');        localStorage.setItem('side-menu', html);        } else {            html = $(obj).closest('.filter.grey-panel').html();            localStorage.removeItem('create-form');        localStorage.setItem('side-menu', html);        }    }, 200);});$(document).on('change', '.filter.grey-panel input[type="checkbox"]', function(e) {    let obj = this;    let cont = $(obj).closest('div.column');    let checked = false;    let arr = [];    $(cont).find('input').each(function(e,t) {        if($(t).prop('checked')) {            checked = true;            arr.push($(t).closest('label').find('span').text());        }    })    if(checked) {        $(obj).closest('tr').attr('data-changed', 'true').attr('data-real', arr.join('|'));    } else {        $(obj).closest('tr').removeAttr('data-changed');    }});$(document).on('input', '.filter.grey-panel input[type="number"], .filter.grey-panel input[type="text"]', function(e) {    let obj = this;    if($(obj).val().length > 0) {        $(obj).closest('tr').attr('data-changed', 'true').attr('data-real', $(obj).val());    } else {        $(obj).closest('tr').removeAttr('data-changed');    }});function change_bool_state(obj, state) {    let cont = $(obj).closest('.toggler');    let tr = cont.closest('tr');    if($(obj).hasClass('sel')) {        $(obj).removeClass('sel');        tr.attr('data-real', 1).removeAttr('data-changed');    } else {        cont.find('.sel').removeClass('sel');        if (state) {            cont.find('button:first-child').addClass('sel');            tr.attr('data-real', 1).attr('data-changed', true);        } else {            cont.find('button:last-child').addClass('sel');            tr.attr('data-real', 0).attr('data-changed', true);        }    }}function apply_filter() {    let params = [];    $('.filter-table tr[data-changed="true"]').each(function(e,t) {        let obj = $(t);        let field_name = obj.find('td:first-child').text();        let field_type = obj.attr('data-field');        let val = $(t).attr('data-real');        switch(field_type) {            case 'bool':                params.push('('+field_name+') = '+val);                break;            case 'list':                let lst = val.split('|');                for(let i in lst) {                    params.push('('+field_name+') = ('+lst[i]+')');                }                break;            case 'input':                let compare = '=';                if(typeof obj.attr('data-compare') !== 'undefined') {                    compare = obj.attr('data-compare');                }                if(typeof obj.attr('data-compare-field') !== 'undefined') {                    field_name = obj.attr('data-compare-field');                }                if(compare === '=') {                    params.push('('+field_name+') '+compare+' ('+val+')');                } else {                    switch(compare) {                        case '>=':                            params.push('('+field_name+') '+compare+' ('+val+')min');                            break;                        case '<=':                            params.push('('+field_name+') '+compare+' ('+val+')max');                            break;                        case '<>':                            params.push('('+field_name+') '+compare+' ('+val+')not');                            break;                    }                }                break;        }    });    if(filter_matrix[0] !== -1) {        params.push('(Тип (категория)) = '+filter_matrix[0]);    }    if(filter_matrix[1] !== -1) {        params.push('(Подкатегория) = '+filter_matrix[1]);    }    if(filter_matrix[2] !== -1) {        params.push('(Множество) = '+filter_matrix[2]);    }    console.dir(params);    update_products(params, 'desktop');}/** * Обновляет по AJAX список товаров * @param filter_array - массив со списком условий фильтров * @param type - mobile | desktop */function update_products(filter_array, type='desktop') {    BACK('products', 'get_product_list', {arr: filter_array}, function(mess) {        mess_executer(mess, function(mess) {            console.dir(mess);            switch(type) {                case 'desktop':                    let cont = $('.vertical-list-products');                    cont.empty();                    for(let i in mess.body) {                        cont.append('<li class="topper">'+mess.body[i]['name']+'</li>');                    }                    break;                case 'mobile':                    break;            }        });    });}// function set_filter(filter_name) {//     setCookies('filter_name', filter_name);//     location.reload();// }// function render_filter_items(type_filter='main_cat|under_cat|action_list', limit=[0,8], append_mode='append|replace') {//// }//// $(window).on('load', function() {//     if(!$mobile) {//         upload_side_menu_filter('desctop');//         let b_width = $('#cat-list').width();//         let count_cat_cards = $('#cat-list .swiper-slide').length;//         let lwidth = $('#cat-list .swiper-slide:first-child').width();//         if(b_width < (count_cat_cards * lwidth)) {////         } else {//             $('#cat-list').css('justify-content', 'center');//         }//     }// });//// function save_map_side_menu() {//     let html = $('.filter.grey-panel').html();//     localStorage.removeItem('create-form');//     localStorage.setItem('side-menu', html);// }//// function upload_side_menu_filter(type='desctop | mobile') {//     if(typeof categorys_all !== 'undefined') {//         let buff_side_menu = localStorage.getItem('side-menu');//         if (buff_side_menu === 'undefined' || buff_side_menu === '' || localStorage.getItem('time_update_side_menu') !== time_update_side_menu) {//             localStorage.setItem('time_update_side_menu', time_update_side_menu);//             console.log('---------------');//             console.dir(categorys_all);//             let pnl = $('<ul class="side-menu"></ul>');//             let cat = null;//             let under_cat = null;//             let list = null;//             for (let i in categorys_all) {//                 cat = categorys_all[i];//                 let cat_item = $('<details type="main-cat" data-id="' + cat['id'] + '"><summary>' + cat['category'] + '</summary><ul class="under-cat-list"><li><a class="first-link" href="/' + cat['cat_trans'] + '">Перейти в "' + cat['category'] + '"</a></li></ul></details>');//                 if (typeof cat['UNDERCATS'] !== 'undefined') {//                     for (let ii in cat['UNDERCATS']) {//                         under_cat = cat['UNDERCATS'][ii];//                         let under_cat_item = $('<li><details type="under-cat" data-id="' + under_cat['id'] + '"><summary>' + under_cat['under_cat'] + '</summary><ul class="action-lists"><li><a class="first-link" href="/' + cat['cat_trans'] + '/' + under_cat['undercat_trans'] + '">Перейти в "' + under_cat['under_cat'] + '"</a></li></ul></details></li>');//                         if (typeof under_cat['LISTS'] !== 'undefined') {//                             for (let iii in under_cat['LISTS']) {//                                 list = under_cat['LISTS'][iii];//                                 let action_list_item = $('<li type="action-list" data-id="' + under_cat['id'] + '"><a class="action-list-item" href="/' + cat['cat_trans'] + '/' + under_cat['undercat_trans'] + '/' + list['translit'] + '">' + list['lists'] + '</a></li>');//                                 $(under_cat_item).find('.action-lists').append(action_list_item);//                             }//                         }//                         $(cat_item).find('.under-cat-list').append(under_cat_item);//                     }//                 }//                 $(pnl).append(cat_item);//             }////             if (type === 'desctop') {//                 $('.filter').empty();//                 $('.filter').append(pnl);//             } else {//                 $('#mobile-side-menu').empty();//                 $('#mobile-side-menu').append(pnl);//             }//             save_map_side_menu();//             console.log('side-menu сгенерировано как новое');//         } else {//             if (type === 'desctop') {//                 $('.filter.grey-panel').html(buff_side_menu);//             } else {//                 $('#mobile-side-menu').html(buff_side_menu);//             }//             console.log('side-menu вызвано из буфера');//         }//     } else {//         console.log('Ожидаем загрузки категорий...');//         setTimeout(function() {//             upload_side_menu_filter(type);//         }, 500);//     }// }