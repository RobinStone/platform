<?php$ans = [];include_once './CONTROLLERS/ajax_before.php';$path = basename(__DIR__, '.php');if(is_dir('./APPLICATIONS/'.$path.'/libs')) {    $files = glob('./APPLICATIONS/'.$path.'/libs/*.php');    foreach($files as $v) {        include_once $v;    }}///////////////////////////////////////////////////////////////////////////////////////////////////////////////// КОД ВЫШЕ ДОБАВЛЯЕМ ВО ВСЕ ajax ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////switch($_POST['com']) {    case 'test':        echo 'Тут находится тестовое сообщение для настройки информационнфх панелей на несколько строк';        break;    case 'create_new_folder_with_tracks':        $err = isset_columns($_POST, ['folder_path', 'arr']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() < 1) {            error('Требуется авторизация +1...');        }        $M = new MEDIA(Access::userID());        if($M->isset_folder('Моя музыка/'.$post['folder_path'])) {            error('Уже существует папка с таким именем...');        }        if($M->add_new_folder_with_tracks_ids('Моя музыка/'.$post['folder_path'], $post['arr'])) {            ans('ok');        } else {            error('Не получилось импортировать папку...');        }        break;    case 'get_tracks_from_id_arr':        $err = isset_columns($_POST, ['arr']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() < 1) {            error('Требуется авторизация +5...');        }        ans('ok', MEDIA::get_array_of_tracks_at_id_arr($post['arr']));        break;    case 'get_my_folders_with_tracks':        if(Access::scanLevel() < 1) {            error('Требуется авторизация +1...');        }        $M = new MEDIA(Access::userID());        $arr = $M->get_all_folders_with_tracks(false);        ans('ok', $arr);        break;    case 'del_complite':        $err = isset_columns($_POST, ['arr']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 5) {            error('Требуется авторизация +5...');        }        if(MEDIA::delete_array_of_track_from_DB($post['arr'])) {            ans('ok');        } else {            error('Не удалось удалить аудио из базы...');        }        break;    case 'move_files_in_folder':        $err = isset_columns($_POST, ['folder_name', 'arr']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 5) {            error('Требуется авторизация +5...');        }        foreach($post['arr'] as $k=>$v) {            $post['arr'][$k] = (int)$v;        }        if($post['folder_name'] === 'GLOBAL') {            $post['folder_name'] = '';        }        if(count($post['arr']) > 0) {            q("UPDATE `file` SET `params`='".db_secur($post['folder_name'])."' WHERE `id` IN (".implode(',',$post['arr']).")");        }        ans('ok');        break;    case 'get_all_tracks':        if(Access::scanLevel() <= 5) {            error('Требуется доступ +5');        }        ans('ok', MEDIA::get_all_audio());        break;    case 'remove_arr_songs_from_folder':        $err = isset_columns($_POST, ['list']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $M = new MEDIA(Access::userID());        if($M->remove_array_of_tracks($post['list'])) {            ans('ok');        }        error('Ошибка удаления списка композиций');        break;    case 'add_arr_songs_in_folder':        $err = isset_columns($_POST, ['list', 'folder_path']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $M = new MEDIA(Access::userID());        if(!isset($M->media_all['folders'][$post['folder_path']])) {            error('Не удалось найти папку по пути ['.$post['folder_path'].']');        }        $arr = [];        foreach($post['list'] as $v) {            $arr[] = (int)$v['id'];        }        if(count($arr) > 0) {            if($M->add_tracks_array_in_folder_path($arr, $post['folder_path'])) {                ans('ok');            }        }        error('Не удалось добавить список...');        break;    case 'find':        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $err = isset_columns($_POST, ['txt']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        ans('ok', MEDIA::find($post['txt']));        break;    case 'change_order':        $err = isset_columns($_POST, ['type', 'name', 'parent']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $M = new MEDIA(Access::userID());        if($post['type'] === 'folder') {            if($M->moove_folder_in_folder($post['parent'], $post['name'])) {                ans('ok');            } else {                error('Ошибка перемещения папки');            }        }        if($post['type'] === 'file') {            if(!isset($post['old_folder'])) {                error('Отсутствуют следующие поля: ', ['old_folder']);            }            if($M->moove_file_in_folder($post['old_folder'], $post['parent'], (int)$post['name'])) {                ans('ok');            } else {                error('Ошибка перемещения файла');            }        }        error('Ошибка типов');        break;    case 'add_folder':        $err = isset_columns($_POST, ['parent_folder_path', 'new_folder_name']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $M = new MEDIA(Access::userID());        if($M->create_folder($post['parent_folder_path'], $post['new_folder_name'])) {            ans('ok');        } else {            error('Создать папку с таким именем невозможно. Есть подозрение, что уже одна такая есть...');        }        break;    case 'get_media_folder':        if(Access::scanLevel() <= 0) {            error('Требуется авторизация...');        }        $M = new MEDIA(Access::userID());        ans('ok', $M->get_complite_tree_folders());        break;    case 'del_folder':        $err = isset_columns($_POST, ['name']);        if(is_array($err)) {            error('Отсутствуют следующие поля: ', $err);        }        if(Access::scanLevel() <= 0) {            error('Низкий уровень допуска');        }        $M = new MEDIA(Access::userID());        if($M->delete_folder($post['name'])) {            ans('ok');        }        error('Папка защаищена от удаления<br>либо является системной...');        break;}echo json_encode($ans, JSON_UNESCAPED_UNICODE);exit;