<?php$P = PROFIL::init(Access::userID());$img = $P->get('avatar');$name = $P->get('saler_name');if($change_name = $P->isset_alert_key('change_name')) {    $change_name = $change_name['text'];} else {    $change_name = '';}if($change_pass =  $P->isset_alert_key('change_pass')) {    $change_pass = $change_pass['text'];} else {    $change_pass = '';}$lst = [    'name'=>[        'title'=>'Ваше имя',        'type'=>'input',        'default'=>'Ваше имя',        'need_change'=>$change_name,    ],    'password'=>[        'title'=>'Смена пароля',        'type'=>'input-pass',        'default'=>'Новый пароль',        'need_change'=>$change_pass,    ],    'phone'=>[        'title'=>'Номер телефона',        'type'=>'phone-changer',        'default'=>'Ваш номер'    ],    'city'=>[        'title'=>'Город',        'type'=>'select',        'table_name'=>'cities',        'column'=>'name',        'save_column'=>'name',        'default'=>'Ваш город'    ],    'email'=>[        'title'=>'E-mail',        'type'=>'input',        'default'=>'email@email.ru'    ],    'about'=>[        'title'=>'Моё резюме',        'type'=>'textarea',        'default'=>'Обо мне'    ],    'insta'=>[        'title'=>'Instagram',        'type'=>'input',        'default'=>'@instagram'    ],    'vk'=>[        'title'=>'VK',        'type'=>'input',        'default'=>'@vk'    ],    'tele'=>[        'title'=>'Telegramm',        'type'=>'teleregistrator',        'default'=>$P->get_field('tele')    ],    'wp'=>[        'title'=>'WatsApp',        'type'=>'input',        'default'=>'@whatsapp'    ],    'workmode'=>[        'title'=>'Режим работы',        'type'=>'input',        'default'=>'00:00 - 00:00'    ],    'ooo'=>[        'title'=>'Данные',        'type'=>'textarea',        'default'=>'-'    ],];echo "<div id='alerts'>".render('alerts')."</div>";?><section class="account">    <h2 class="h2">Управление аккуантом</h2>    <div onclick="mobile_back_row()" class="mobire-back-row flex align-center gap-10">        <span class="svg-wrapper"><?=RBS::SVG('left_long_row')?></span>        <span>Назад</span>    </div>    <table>        <tr>            <td colspan="2">                <div class="flex align-center gap-20">                    <img src="<?=$img?>" width="66" height="66" style="display: inline-block; border-radius: 50%; object-fit: cover">                    <span style="font-weight: 600;font-size: 20px;color: #018536;"><?=$name?></span>                </div>            </td>            <td style="position: relative">                <?php                if(isMobile()) {                    echo '<button onclick="upload_user_file_form(sayer)" class="action-btn btn-save-edit-mobile"></button>';                } else {                    echo '<button onclick="upload_user_file_form(sayer)" class="action-btn">Сменить фото</button>';                }                ?>            </td>        </tr>        <?php        if(!isMobile()) {            foreach($lst as $k=>$v) {                switch($v['type']) {                    case 'input': ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td><input class="inpt-field" type="text" name="<?=$k?>" value="<?=$P->get($k, $v['default'])?>" readonly="readonly"></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn">Изменить</button></td>                        </tr>                        <?php break;                    case 'phone-changer': ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td data-name="<?=$k?>"><span><?=$P->get($k, $v['default'])?></span></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn">Изменить</button></td>                        </tr>                        <?php break;                    case 'input-pass': ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td><span>старый пароль</span></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn">Изменить</button></td>                        </tr>                        <?php break;                    case 'teleregistrator':                        $txt = "Привязать";                        $tele = 'НЕТУ';                        if($P->get_field('tele') !== '-' && $P->get_field('tele') !== '') {                            $txt = 'Отвязать';                            $tele = 'ПРИВЯЗАН';                        }                        ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td><span><?=$tele?></span></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn"><?=$txt?></button></td>                        </tr>                        <?php break;                    case 'select': ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td><input class="inpt-field" list="<?=$v['table_name']?>" type="text" name="<?=$k?>" value="<?=$P->get($k, $v['default'])?>" readonly="readonly"></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn">Изменить</button></td>                        </tr>                        <?php break;                    case 'textarea': ?>                        <tr class="<?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> ">                            <td><?=$v['title']?></td>                            <td><textarea rows="4" cols="30" class="inpt-field" type="text" name="<?=$k?>" readonly="readonly"><?=$P->get($k, $v['default'])?></textarea></td>                            <td><button data-type-block="<?=$v['type']?>" class="action-btn">Изменить</button></td>                        </tr>                        <?php break;                }            }        } else {            foreach($lst as $k=>$v) {                switch($v['type']) {                    case 'input': ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div><input class="inpt-field" type="text" name="<?=$k?>" value="<?=$P->get($k, $v['default'])?>" readonly="readonly"></div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile">Изменить</button></div>                            </td></tr>                        <?php break;                    case 'phone-changer': ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div style="font-size: 14px; color: #6b6b6b" data-name="<?=$k?>"><?=$P->get($k, $v['default'])?></div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile">Изменить</button></div>                            </td></tr>                        <?php break;                    case 'input-pass': ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div style="font-size: 14px; color: #6b6b6b">Старый пароль</div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile">Изменить</button></div>                            </td></tr>                        <?php break;                    case 'teleregistrator':                        $txt = "Привязать";                        $tele = 'НЕТУ';                        if($P->get_field('tele') !== '-' && $P->get_field('tele') !== '') {                            $txt = 'Отвязать';                            $tele = 'ПРИВЯЗАН';                        }                        ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div style="font-size: 14px; color: #6b6b6b"><?=$tele?></div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile"><?=$txt?></button></div>                            </td></tr>                        <?php break;                    case 'select': ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div><input class="inpt-field" list="<?=$v['table_name']?>" type="text" name="<?=$k?>" value="<?=$P->get($k, $v['default'])?>" readonly="readonly"></div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile">Изменить</button></div>                            </td></tr>                        <?php break;                    case 'textarea': ?>                        <tr class="mob-font <?php if(isset($v['need_change']) && $v['need_change'] !== '') { echo ' alert '; } ?> "><td colspan="3">                            <div style="margin-bottom: 5px"><?=$v['title']?></div>                            <div><textarea rows="4" cols="30" class="inpt-field" type="text" name="<?=$k?>" readonly="readonly"><?=$P->get($k, $v['default'])?></textarea></div>                            <div><button data-type-block="<?=$v['type']?>" class="action-btn btn-save-edit-mobile">Изменить</button></div>                            </td></tr>                        <?php break;                }            }        }        if(!isMobile()) {        ?>        <tr>            <tr id="alerts" class="alert-mess-btn-container <?php if($P->isset_alert_key('attantion_on_notification')) { echo ' alert-2 '; } ?>">                <td>Оповещения</td>                <td colspan="2">                    <div class="flex gap-5">                        <button onclick="toggle_action('tele', this)" class="action-btn rect-btn off flex column center">                            <img src="/DOWNLOAD/20230507-190656_id-2-125725.svg">                            <span>По Telegramm</span>                        </button>                        <button onclick="toggle_action('email', this)" class="action-btn rect-btn off flex column center">                            <img src="/DOWNLOAD/20230803-132753_id-2-647524.svg">                            <span>По E-mail</span>                        </button>                        <div class="micro-text">                            Если вы являетесь продавцом и хотите получать уведомления от потенциальных покупателей                            - включите один, несколько или все каналы уведомлений.                        </div>                    </div>                </td>            </tr>        </tr>        <?php } else { ?>            <tr id="alerts" class="mob-font <?php if($P->isset_alert_key('attantion_on_notification')) { echo ' alert-2 '; } ?>"><td colspan="3">                    <div style="margin-bottom: 5px">Оповещения</div>                    <div class="flex gap-5 alert-mess-btn-container">                        <button onclick="toggle_action('tele', this)" class="action-btn rect-btn off flex column center">                            <img src="/DOWNLOAD/20230507-190656_id-2-125725.svg">                            <span>По Telegramm</span>                        </button>                        <button onclick="toggle_action('email', this)" class="action-btn rect-btn off flex column center">                            <img src="/DOWNLOAD/20230803-132753_id-2-647524.svg">                            <span>По E-mail</span>                        </button>                        <div class="micro-text">                            Если вы являетесь продавцом и хотите получать уведомления от потенциальных покупателей                            - включите один, несколько или все каналы уведомлений.                        </div>                    </div>                </td></tr>        <?php } ?>    </table></section><?phpif(count($lst) > 0) {    foreach($lst as $v) {        if($v['type'] === 'select') {            $rows = SUBD::getAllDB($v['table_name']);            if(is_array($rows)) {                echo '<datalist id="'.$v['table_name'].'">';                foreach($rows as $val) {                    echo '<option data-save="'.$val[$v['save_column']].'" value="'.$val[$v['column']].'"></option>';                }                echo '</datalist>';            }        }    }}?><script>    $(document).on('click', '.account button', function(e) {        let obj = this;        if($(obj).text() === 'Изменить') {            if($(obj).attr('data-type-block') === 'input-pass') {                info_inputString(transform_pos('center'), function() {                    let pass1 = bufferText;                    if(pass1.length < 5) {                        say('Пароль должен состоять минимум из 5-ти символов...', 2);                        return false;                    }                    info_inputString(transform_pos('center'), function() {                        if(pass1 === bufferText) {                            SENDER('change_pass', {pass: bufferText}, function(mess) {                                mess_executer(mess, function(mess) {                                    say('Пароль успешно изменён!');                                    update_alerts();                                    $(obj).closest('tr').removeClass('alert');                                });                            });                        } else {                            say('Введённые пароли - не совпадают...', 2);                            return false;                        }                    }, 'Подтвердите новый пароль:', '', 'Изменить пароль');                }, 'Введите новый пароль:', '', 'Подтвердить');            } else if($(obj).attr('data-type-block') === 'phone-changer') {                open_popup('phone-changer');            } else {                $('.edited').removeClass('edited');                $('.inpt-field').each(function (e, t) {                    $(t).attr('readonly', 'true');                });                $(obj).closest('tr').find('.inpt-field').removeAttr('readonly');                $(obj).closest('tr').find('.inpt-field').addClass('edited');                $(obj).closest('tr').find('.inpt-field').focus();                $(obj).closest('tr').find('.inpt-field').select();                $(obj).closest('tr').find('.inpt-field').attr('data-old', $(obj).closest('tr').find('.inpt-field').val());            }        } else if($(obj).text() === 'Сохранить') {            let old = $(obj).closest('tr').find('.inpt-field').attr('data-save', 'true');        } else if($(obj).text() === 'Привязать') {            SENDER('tele_subscribe', {}, function(mess) {                mess_executer(mess, function(mess) {                    location.href = 'https://t.me/rumbra_bot?start=telesubstr'+mess.body;                });            });        }    });    $(document).on('input', '.account input, .account textarea', function(e) {        let obj = this;        $(this).attr('data-changed', 'true');        if($(obj).val() !== $(obj).attr('data-old')) {            $(obj).closest('tr').find('td:last-child button').text('Сохранить');            $(obj).closest('tr').find('td:last-child button').addClass('green-btn');        } else {            $(obj).closest('tr').find('td:last-child button').text('Изменить');            $(obj).closest('tr').find('td:last-child button').removeClass('green-btn');        }    });    $(document).on('blur', '.edited', function(e) {        let obj = this;        setTimeout(function() {            let saved = $('*[data-save="true"]');            setTimeout(function() {                if($(saved).length > 0) {                    let old = $(saved).attr('data-old');                    let val = $(saved).val();                    let arr = [];                    arr.push({  // массив для изменения нескольких параметров                        param: $(saved).attr('name'),   // тут - что лишь параметр профиля                        val: val,                    })                    // console.dir(arr);                    SENDER('change_profil_params', {params_arr: arr}, function(mess) {                        mess_executer(mess, function() {                            update_alerts();                            if($(saved).attr('name') === 'name') {                                $(obj).closest('tr').removeClass('alert');                            }                        });                    });                } else {                    $('input[data-changed="true"]').val($('input[data-changed="true"]').attr('data-old'));                    $('textarea[data-changed="true"]').val($('textarea[data-changed="true"]').attr('data-old'));                }                $(obj).closest('tr').find('.inpt-field').addClass('readonly');                $(obj).closest('tr').find('.inpt-field').removeClass('edited');                $(obj).closest('tr').find('td:last-child button').text('Изменить');                $(obj).closest('tr').find('td:last-child button').removeClass('green-btn');                $(obj).closest('tr').find('.inpt-field').removeAttr('data-save');                $(obj).closest('tr').find('.inpt-field').removeAttr('data-changed');            }, 1);        }, 200);    });    load_JSscript_once('./TEMPLATES/JS/user_uploader.js');    function sayer(mess) {        if(mess.status === 'ok') {            let arr = [];            arr.push({  // массив для изменения нескольких параметров                field: 'avatar',   // тут указываем, что хотим изменить само поле или                param: 'avatar',   // тут - что лишь параметр профиля                val: mess.sys_name,            })            SENDER('change_profil_params', {params_arr: arr}, function(mess) {                mess_executer(mess, function() {                    location.reload();                });            });        }    }</script>